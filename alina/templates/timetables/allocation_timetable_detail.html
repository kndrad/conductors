{% extends '_base.html' %}

{% load static %}
{% load date_representations %}

{% block extra_title %}{{ timetable.month }}.{{ timetable.year }} | {% endblock %}

{% block scripts %}
<script type="module" src="{% static 'allocations.js' %}"></script>
{% endblock %}

{% block navbar_buttons %}
    <span>{{ timetable.get_month_display }} {{ timetable.year }}</span>
    <form class="text-center bg-green-600 rounded" method='POST'
          action='{% url 'update_allocations' timetable.pk %}'>
        {% csrf_token %}
        <button class="text-sm py-1 px-2"
                type="submit">
            Aktualizuj
        </button>
    </form>
{% endblock %}

{% block content %}
<div class="flex flex-col items-center text-white text-center px-2.5">
    <div class="mb-2 text-sm">
        <span>
        Ostatnia aktualizacja: {{ timetable.last_updated|represent_date }}
        </span>
    </div>
    <div class="w-full mb-3 border border-opacity-50 rounded">
        <table class="table-auto border-collapse w-full px-3 text-center">
            <thead class="bg-white bg-opacity-5">
                <tr>
                    <th class="py-2 px-2 w-8">Dzień</th>
                    <th class="py-2 w-full">Służba</th>
                </tr>
            </thead>
            <tbody>
            {% for day in timetable.get_month_days %}
                <tr id="day{{ day }}" class="w-full border border-white border-opacity-25">
                    <td class="py-1.5 border border-white border-opacity-25 font-semibold text-3xl">
                        {{ day }}
                    </td>
                    {% for allocation in allocations %}
                        {% if allocation.start_day == day %}
                            <td class="py-1.5 px-2 text-xl">
                                <button id="{{ allocation.title }}" class="w-full py-1 bg-blue-900 rounded-2xl">
                                    <a href="{% url 'allocation_detail' allocation.pk %}">
                                    {{ allocation }}
                                    </a>
                                </button>
                            </td>
                        {% endif %}
                    {% endfor %}
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}