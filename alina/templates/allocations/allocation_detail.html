{% extends '_base.html' %}

{% load static %}
{% load alina_dates %}
{% load date_representations %}

{% block extra_title %}{{ allocation.title }} | {% endblock %}

{% block navbar_buttons %}
    <form class="bg-green-600 rounded" method='POST' action='{% url 'update_allocation' allocation.pk %}'>
    {% csrf_token %}
        <button class="px-2 py-1 tracking-wider">Aktualizuj</button>
    </form>
{% endblock %}

{% block content %}
    <div class="flex items-center flex-col w-full px-2.5 mb-2 text-white">
        <p class="mb-1">Ostatnia aktualizacja: {{ allocation.last_updated|represent_date }}</p>
    {% if allocation.allocationdetailset.exists %}
        <p class="text-sm italic">Aby zobaczyć załogę, kliknij w numer pociągu.</p>
    {% endif %}
    </div>

    <div class="w-full bg-white flex-col bg-opacity-5 p-1 px-2.5 pb-4 rounded">
        <div class="w-full text-center text-white text-4xl font-bold tracking-wider my-2 mb-4">
            {{ allocation.title }}
        </div>
        <div class="flex justify-between space-x-1 px-1 border border-white mt-2 border-opacity-25 rounded">
            <div class="w-full text-white mb-2 p-1 space-y-0.5">
                <div class="mb-2 text-center">
                    <p class="text-center text-sm italic">Początek</p>
                    <p>{{ allocation.start_date }}</p>
                </div>
                <div class="mb-2">
                    {% if allocation.train.before %}
                        <p class="text-center text-sm italic mb-1">Pociąg przed</p>
                        <div class="bg-blue-700 rounded py-1 px-2 text-center">
                            <div class="flex items-center justify-between">
                                <div class="text-sm italic">Start</div>
                                <div class="font-semibold italic">
                                    {{ allocation.train.before.departure_date|represent_hour }}
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="text-sm italic">Pociąg</div>
                                <div class="font-semibold italic">
                                    {{ allocation.train.before.carrier_initials }} {{ allocation.train.before.number }}
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="text-sm italic">Koniec</div>
                                <div class="font-semibold italic">
                                    {{ allocation.train.before.arrival_date|represent_hour }}
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <div class="text-center bg-blue-600 rounded w-full">
                            <form method='post' action="{% url 'search_train_before_allocation' allocation.pk %}">
                            {% csrf_token %}
                                <button class="py-1 font-semibold">Załaduj pociąg</button>
                            </form>
                        </div>
                    {% endif %}
                </div>
            </div>
            <div class="w-full text-white mb-2 p-1 space-y-0.5">
                <div class="mb-2 text-center">
                    <p class="text-center text-sm italic">Koniec</p>
                    <p>{{ allocation.end_date }}</p>
                </div>
                <div class="mb-2">
                    {% if allocation.train.after %}
                        <p class="text-center text-sm italic mb-1">Pociąg po</p>
                        <div class="bg-blue-700 rounded py-1 px-2 text-center">
                            <div class="flex items-center justify-between">
                                <div class="text-sm italic">Start</div>
                                <div class="font-semibold italic">
                                    {{ allocation.train.after.departure_date|represent_hour }}
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="text-sm italic">Pociąg</div>
                                <div class="font-semibold italic">
                                    {{ allocation.train.after.carrier_initials }} {{ allocation.train.after.number }}
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="text-sm italic">Koniec</div>
                                <div class="font-semibold italic">
                                    {{ allocation.train.after.arrival_date|represent_hour }}
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <div class="text-center bg-blue-600 rounded w-full">
                            <form method='post' action="{% url 'search_train_after_allocation' allocation.pk %}">
                            {% csrf_token %}
                                <button class="py-1 font-semibold">Załaduj pociąg</button>
                            </form>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% for detail in allocation.allocationdetail_set.all %}
            <div class="border border-white border-opacity-10 rounded my-3 text-white text-center w-full">
                <div class="text-center text-xl m-1">
                    <div>{{ detail.action }}</div>
                </div>
                {% if detail.train_number %}
                    <a href="{% url 'train_crew' detail.train_number detail.action_date|date_for_alina %}">
                    <div class="font-bold text-xl bg-blue-900 py-1 rounded w-11/12 mx-auto mb-3">
                        {{ detail.train_number }}
                </div>
                </a>
            {% endif %}
                <div class="bg-white bg-opacity-5 py-1 px-2">
                    <div class="flex items-center justify-between">
                        <div class="text-xs italic">Rozpoczęcie</div>
                        <div class="text-sm">{{ detail.start_location }} {{ detail.start_hour }}</div>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="text-xs italic">Koniec</div>
                        <div class="text-sm">{{ detail.end_location }} {{ detail.end_hour }}</div>
                    </div>
                </div>
            </div>
            {% endfor %}
    </div>
    <a href="{% url 'allocation_timetables' user.pk %}">
    <div class="text-center text-white font-semibold bg-blue-600 py-1 px-2 my-4 mx-3 mx-auto w-full w-11/12 rounded">
        Wróć
    </div>
    </a>
{% endblock %}